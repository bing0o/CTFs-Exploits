#!/usr/bin/env python
# -*- coding: utf-8 -*-
#
#  explore_haystack.py
#  
#  Copyright 2019 bingo <bingo@hacklab>
#  

from pygments import highlight, lexers, formatters
from cmd import Cmd
import requests

class Terminal(Cmd):
        # the right query is: SELECT * FROM quotes
        # the key is "clave" ;)
        prompt = 'bing0o$ '

        def default(self, args):
                data = '{"query" : "%s"}' % (str(args))

                r = requests.post("http://haystack.htb:9200/_xpack/sql", data=data, headers={"Content-Type" : "application/json"})
                #print(r.text)
                shit = r.text
                haystack = highlight(shit, lexers.JsonLexer(), formatters.TerminalFormatter())
                print(haystack)

terminal = Terminal()
terminal.cmdloop()
